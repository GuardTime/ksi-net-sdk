/*
 * Copyright 2013-2016 Guardtime, Inc.
 *
 * This file is part of the Guardtime client SDK.
 *
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *     http://www.apache.org/licenses/LICENSE-2.0
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES, CONDITIONS, OR OTHER LICENSES OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 * "Guardtime" and "KSI" are trademarks or registered trademarks of
 * Guardtime, Inc., and no license to trademarks is granted; Guardtime
 * reserves and retains all trademark rights.
 */

using System.Security.Cryptography.X509Certificates;
using Guardtime.KSI.Exceptions;
using Guardtime.KSI.Test.Crypto;
using Guardtime.KSI.Trust;
using Guardtime.KSI.Utils;
using NUnit.Framework;

namespace Guardtime.KSI.Test.Trust
{
    [TestFixture]
    public class PkiTrustStoreProviderTests
    {
        [Test]
        public void VerifyTest()
        {
            byte[] data =
                Base16.Decode(
                    "4B53495055424C4687010009010101020456C48F31870202C40104A42C61AD800202BA308202B63082019E020101300D06092A864886F70D01010B05003021310B300906035504031302483131123010060355040A1309477561726474696D65301E170D3132313132363132323530385A170D3134313232363132323530385A3021310B300906035504031302483131123010060355040A1309477561726474696D6530820122300D06092A864886F70D01010105000382010F003082010A0282010100BA8DD3E9BF9A00D013477054D566907C0848C666F5A2C7829681B0156C98906A22F1D9382646B8A6B408BBA20436A963E92496F182729052FA4BFFDD77B4C1F56E52F63D7624D9F47AC54FE31770E806F40103B4EB5F7F4E95C4E7F863BF9E887DFE1CF7FDAE5E6F2A78E76032168C3F83B233BC409FFE44FC1BE39C223E1A58AFCCEEA6E6AE3F7C781FE3EADE64B81176EA59722F313126BE2224E4D2B82691EC14F7C96B8B0B7AC052D5C9686D17890C6499377A21BB7918AF29481B6C41F29E26FF624D44BA234F77AEA67C75288FF7F936B1AB6B93DFE1CB8EB89E21B25E22967E21305817847BAA2483B170B5967B6472F8D88013A8B05199B23DAAF6D702030173B3300D06092A864886F70D01010B0500038201010046C7BE7E81640AD3B930C4FA8A70374359E8576D435D36B51D6A58C70D1A028A20273576F4294C2B140F95F844BDBAA44D1A372F6507A1C56B6BCD952E193B3ECB01BC4A5A7F43C124C7655081983CFB713840A29E9869577E7F671893A68FE059C85ABD1D7D24D3AB1216C855118A9E532C2E2F82ED85BC946E414DCB4C172975B8B95B0552C71812E550B3A44739A940BB919146055FDACDEE820315281369D6ACADEE763FFC454392A54C9A785F9FE28100911FF130ABDDD71B968E5D3DAD1C8E0FBD61ED685F98D0090C761955156D865E970496EFF8330E923A65B5F785507CAF666F5E5C4667521F8A4BC5692783BAD9503EACDC15E9ED9081A695BBB3870202C40104A30B4F74800202BA308202B63082019E020101300D06092A864886F70D01010B05003021310B300906035504031302483231123010060355040A1309477561726474696D65301E170D3132313132363132343034365A170D3134313232363132343034365A3021310B300906035504031302483231123010060355040A1309477561726474696D6530820122300D06092A864886F70D01010105000382010F003082010A0282010100C6505CD70C8F0A5908FCFD47192DFD4179C1C71B7F986280371707D97DD36395B45EA51770CA9431F29D1135BBDC642E5E3FB4E738BCFCB4203DE6305C94B5CE38C10A2DE21D6DC12E111AD534D67A329942B0B05FC5FD2B499CCF7208D403CBE7444663FAB2EA624530B7A3F6AADDEEC024FF6269BA0F6E541B7EF74D7FF4E7CFBBFBC6257EDB29128C143D9B75136DD9CE94EB39B7ABBD94A2AAFCB8575F9E7CE3D066AD01FE1EF58649B0D3EFF3B9627DBE34D4852DEC75EF3A02A0DFF2CDEAE86D456D5107F6296727C5D98A96A6F797D9C7E91109E050FD88ADC3E95878B70615028E274B99BAA328DC79C57097CD91DDBBB80D589A2F77F1254E0B2A5F0203016E2B300D06092A864886F70D01010B0500038201010074754D519522E04B793B6B7E5CD73F86E7B1CCC4B9D2EEDFA0F475329CC13BC17860786049DA069EBDBCA4F6FDBA0D6DD799D0F9BA7EDECF418473420E6FF0D565AA6630ABCA40C4D86BCB018E2023B29E85BB9A745BA280CA550DB90ADE2F749C1D7FFA5CAC9D25F45D565F7319E6B3602933D6EAC5EB311797A237C57FFD98C00BDDC0F8404E3B51BE75D886490DD1A797BE480F88F31CB443F49448997A5C169BE0E35451CECBC975778FB7F2BBE1DB9B6E0A1C71725FE9E39FC7EF1A409DD1CED6AA4A12EF43272EAAE5E58170D82F1D57FB5135D20ED22E44239C4BA834436CB3EF6B1D5B567F9B55BFEBB4E8623A1F430BE1735E02AE14240F4E694400870202C40104C246B139800202BA308202B63082019E020101300D06092A864886F70D01010B05003021310B300906035504031302483331123010060355040A1309477561726474696D65301E170D3132313132363133303031365A170D3134313232363133303031365A3021310B300906035504031302483331123010060355040A1309477561726474696D6530820122300D06092A864886F70D01010105000382010F003082010A0282010100D59264B31F602EDB714E006902313742654A0709C38757B10FA95C459B079AD35812D270DF023CC551CB9DBE0611B5AC3AAFAAF864F2C2FA9A812345BB163795A51400B8ACA96068627B620477614040B0C1E209C997AF19ECAF41F8D8DCF2BBF029BAEA8B1F8DDD17AA173F4810D6F0B46AD78FDD123050680A87E499409EF9FCB91FF6188E1B9DEF09D952160FC3B0EC614FB97AA021F5D3573520F883138B0E8660203E3D1BDE777D2DA99207592885A9665FBF85FB624C32C3F76341D07630A2A10965919233E45428CC4F791887CFA82819CAA85E9FD68DE5F2779BA23F84D05FC2ACBC04100D306B06CF0315B1652FB30E13333EBEF5763DD15D5346D10203010EC9300D06092A864886F70D01010B05000382010100BFC89EF99AF615148FBB5C64028A365666D9B92D77A8E0B96F9E1546DFEE6D737D22F0DECABCE66C05925F21483955FDDE296AC24909DF0A9862E48B94FD04CFD3023BF37F5836A2B046300AE166460D9D892E2531DCC5EB4B16AB7207174C28688E6E685F4C8D58340724A269EFB1ABAC27C7A3B0A285C454DC590D5339E2F7BF737FB19FDCFE9C1577CD196D3228FE4FDD1706D156486E8F743E0C38BFF2D95C197480A690555FEB85A831AE76EDD367C5D063B557ED9487FF6AC83B94999B409B8003856108AD0CB28B2171014BA4785B89F9E7D2FE75721A4AD011DD4F099B1F165D6312B1AD45255CA7CA254B50C330D3B995810194B3620AF358215EC6870202C40104026E4256800202BA308202B63082019E020101300D06092A864886F70D01010B05003021310B300906035504031302483431123010060355040A1309477561726474696D65301E170D3132313132363133303734375A170D3134313232363133303734375A3021310B300906035504031302483431123010060355040A1309477561726474696D6530820122300D06092A864886F70D01010105000382010F003082010A0282010100CD56DBE1EF5B1980561CB2FE9AFF3454DFF89BCBA296373B62123CEE2E5DA86AAB141151EAE24A40023EBF1E5F943E9204C0F11C901EABA4646078DFFE2BEE1B5894EBC61FFB4BF937B10887A334C060839FE93202E3100AE6B8E47D1C8935664C6CA5394A15C60BE0CC879B27E592EDC4E2EC84FE1B563083ACA51BF9B3490B1604FD44F83776D23E3DE3E390A0627C2A00D5AED8C15872EBB0488E8CF8188B59103D1CD2F01C5DE75626C2089B72A35EE0378A1ADB7EA1EB5FFE85E86A2026BDC5E3C105187D81AA37E5DB4534E11480437EAA3A971A4501ADC16CB7A486D271A1EBB00625C41E92EDD0294F19F35AA8718F4D85429E5E8ADD0B50BF5CFB1F0203015861300D06092A864886F70D01010B05000382010100601D69A37C672FC1595047FA12D3F8B5C524B2A61716AA44A462C8FB6E7AB0911E62A3947C3C26A9558C1D540D4CB804DD4B2F4E24EA2C1CA595FF6A1BAF946D1CC2B75F8B6FE577EFA7832310F1E70512F8EF962E6EF64AA2592171C03B40EDF539AEC4E6F909E2E619253C0EB454C40792ECA5C79A077A3A32BCFA0111FB7FB509D0DD02FEADEEC2B34EA29FC86406D5A77582BD8F2A2DEC6F7DC167D1E53118CD8424CDED4BD284E39B2496FFE124AEC4FAE9799158742E60B828E6D2F90FEA0EE87DAD7DE88A4393CED3ECC32F04092588EFBC84C254AB9D47BFEC1F5BFAFC1E275EEBDC87CDA0680CE57C72B710FE9343B0810B7730FAE67BAA48207486870202C401049A658294800202BA308202B63082019E020101300D06092A864886F70D01010B05003021310B300906035504031302483531123010060355040A1309477561726474696D65301E170D3132313132363132353332325A170D3134313232363132353332325A3021310B300906035504031302483531123010060355040A1309477561726474696D6530820122300D06092A864886F70D01010105000382010F003082010A0282010100B33669A91E3646FEB6FCC585011F94E04A4484F6D91597E260B647A8918D012D9BEB26133D4D9FD75F701B37969A8095A7320C4F0C10B24D8700ED7CEC5BA9519502BB8329BECDB2E2F5B98B11CA50CC461D790B38062DFD1DBE2FB651D838542375C9391F40826A22E82552715F86F9CB575CCC98D73799FBA64065FD85D7B88B7887FE356DD64AC36E63FCAC4419653F0A695976BAC33F3616F3969893EF9D6CEFAE2ACA51924210655FA29A9494A5BC233A83745637EB99B27BB3E8B2BC1F788FAAAFBD24E5E77EEE158E9338AFFF5B73B83ABB4477CCDEDDA89E3C2E75EF24CCF0841A50EACDCBFA688DA9FB16486F2DC562D5DB9020BB80703BBB81A42302030130C7300D06092A864886F70D01010B0500038201010039DDAE4FCF093A865666EBB631569982232F21606D48A14A81C77F6FA4C3AE8CCE2EFB2C590373E0984B3E4CD69223B1741EF9AF8A92BBE973D60A92FC674FCD6DB6249DB91BA308DC36212AD87C554FF751F3C61EA19769A745217A2CE2EC35B642692263907E093EE15D9D8EF0522A332859ADFFA4FFE6ABB807BA2C1F9A3EB0BB8224A7209347D782CB31E3524CF995167F92614BF41451A3E25B5F2CE1239998D98EE70D48615546EF46D4397B281AC566AC136EB907A290F3DD137D0E01FFB838307CDABB9D519A24FD9AD25BAF69F9E8806E42CAAA555F7752F1D39C5E2DFFC406022F9525D15040875762C39936F026AD700E31E1E4D1CDED9F08DB62870202C40104CEDA4885800202BA308202B63082019E020101300D06092A864886F70D01010B05003021310B300906035504031302483131123010060355040A1309477561726474696D65301E170D3134313230393038343534335A170D3137303130393038343534335A3021310B300906035504031302483131123010060355040A1309477561726474696D6530820122300D06092A864886F70D01010105000382010F003082010A0282010100CB2ADDD26091F1F98D33432A63E37DE3F64DB706D47B5712F2F850CBE781A4AA60220A66A49D6CFF9D1CB5F4533E9037DC88CF763B24A79DE37E9CECB291FA1B949D2E2F608884DE6F6084D5F50BC7C4D36C8A3D2EACE896BB9797BA2E8DE93FA564F3A5F77F0498D7A8AC96E0CC6EC57832627795B8911044F5AA624413E9DD815E865D1CAF270180B63A90796FBE81F7DC0830B16F596E9D81EE3594F7619D1F50F7681C39270844852234D6CAA3708ECE75B87B3D96B282C5E9A154725B54F93F30C3475FAAA161E86A4FE837D274357304015CACC29CAD434ADC90E21B9D785F03BBDAD962D0F3E1AE226EF02B0AAE4B6C2DAA004F6F2BCEEEB3F82FF01F020301E041300D06092A864886F70D01010B050003820101008E761877047BBE6A07C4A9B34EC6DD3540F975E1F8F18565848CAC7E5BB27D6E26F6833436F57E5D5D4022BE6226EDA31CD5334A5DC815651C55AC7B1D704E9766B2DB266583FC5DA8FD7B369B37A9CF482CFAA5DCE115428CD971B492E9F2E892C016E363AAC875DD2C6C0130112FAC99BFB2F63C8E557255C76DCA5184D6AA8937932B12DF5EA7D38125F57F544634923FAF84A8893053F8F149D937097DCE464EE46E9DA4DE19521EF90188AEFD1F5970256729464C5B3382AD9EDA187FD62F4A165C43EE04B520FBD246BC4755675312333D0474A331DFF2E8BEA343D4E2F6A5BE518CF6091A3CB0E6207C1EDAC40D66566BFF5BAD1342BDA990297B1833870202C40104091C54B1800202BA308202B63082019E020101300D06092A864886F70D01010B05003021310B300906035504031302483231123010060355040A1309477561726474696D65301E170D3134313230333132323030365A170D3137303130333132323030365A3021310B300906035504031302483231123010060355040A1309477561726474696D6530820122300D06092A864886F70D01010105000382010F003082010A0282010100BCA231676AAB28EE86CB7D2EAC0E7F0C8F6DACFD972663635BC1F1B2D76C57FB5169123830AF079AF14ABA612E7932FBB1FE845C061D94B201719E7D0897348B82B991C74B78D8F56EB9FCA0717546CBEBE8623C6C3895243FCB85A9DBFE4212CF5074F257330A1C862F5446B8DF87472A248ADA7C16929155A844368484D4FEE4AFDD9017EB817EEE226E225ADA79F759D100BAB9C74EB31005C02DC5107F877CFA55DAB6FA9E1B01BBC87120658EA831E809C777CB41F6FBB9FF044D6998E0A4B93D23D6D294D8DC14AC4BD67D19DADB1CB1FB335F7FD3E670D46B953D32CADAF88210AE4096DC1A903BF8419FE6318A7C68CBD712FA197C276F75B6DD23C30203011D63300D06092A864886F70D01010B05000382010100BC66C6CD10CD18432250A679D06782638660805DF6C2774ED5976A4FB87097A63EDB6B28F7AD5A50E7487C96DA57AE3BA9DE214B6F2925D5113AC8A9B5F46366E7DFBA8FB1E06EDF6F38A962E2D9F01886138A7F3D8F12E526724D3EA77C0A1FA88382C5E08E642EBBAC0EF66D7E63CA81FCAFA64B08BC829C63054DFC68F0A042B3D99C801B04FA63BB63416F6E357A9F9A3A5A2729044EF8A72C3CCC18CCBB74C449A48E8A6AE1D465D22F8D97F9B711573524222C96F483DFBB5405021B129BEFECEAD76EFDFBC6F63D0ABE09456AEB8EB44EEA7D5DD8D4B175A8078F0A1B74180F0905C6AABA0CC5434BD04A6B56695B44DBD69319A3E3077A3D829F9DA4870202C40104644C740D800202BA308202B63082019E020101300D06092A864886F70D01010B05003021310B300906035504031302483331123010060355040A1309477561726474696D65301E170D3134313230343039323831315A170D3137303130343039323831315A3021310B300906035504031302483331123010060355040A1309477561726474696D6530820122300D06092A864886F70D01010105000382010F003082010A0282010100B5E6C54A2C1709E8D44C166319C72072FE4282701AFCCF0A336D9FB7732B8A79193CB36FBD2041F4C6496913D3310A60DA5BAE6BA64DB8697D3503D2EF61A33F267F1BCC4F47F79E70B914D665B5295B6DA29632F18EADF1E9B3369B0301FC146458F2BFD0167C98ED5739714687A7910F93AA2D70DE9F70179E8DCB831A626CAEE31DE91F5F5693D86DF9736CC37199A27FCE9B422152C4FC48FF125788972CC17DD79750A811DA3288E872608975EF9E902B334BFF2CD7CB85BB15CCE4E608DAC7E91EF6C9E774F83F6673F328B1C9A303723F3A1B846D11ED6EDE1BF4BB069C4C4C41B76A5037059BD5DA09950F0F01A7CB7A98D36DC606D62FA7EA29076B0203016F97300D06092A864886F70D01010B050003820101002C82652B380E2551F45BD145409E5C0538CE9BE53B6FA7940A8BFD29CAEB9EDA1CD6E79D02AAB417685B837F19FE8FC73DBB07B3C1D5CD69D6A8262B3BD57B029FC21FB7ED7A02231A9E9E82F3C002C6374C0F9DEDDD541D497FC0CC10CB44081E64B5931DFC123C7E073A5656010E70D76BEAAED7785B4C762E595D1D22892C78D3A8354F6DC1C0019F5E04D00B04C1F6A56695E9B3D2D0823571EB4F696700C5450A378A0CD8E2A2B1A62BD40F4C72AE38EC87951E6E574B8F62BB82D16E6EB7A7B90B917AB545209F3656636C01D145CF256C0977547542CEFB0C5C9C88C2525018DA5F0210CEF4CFF5179AE082AA7A2A3E699793FA0421DA8F2D942A4777870202C40104F4423291800202BA308202B63082019E020101300D06092A864886F70D01010B05003021310B300906035504031302483431123010060355040A1309477561726474696D65301E170D3134313230353039343033355A170D3137303130353039343033355A3021310B300906035504031302483431123010060355040A1309477561726474696D6530820122300D06092A864886F70D01010105000382010F003082010A0282010100A07681F9ADBAF1F6BFC2916EE07478C41AD2655583FDFEC176E96D32315BF2100A705C993D71C33914D7899671CEF780D0E2340860653C32716ED17B3C165AD1238EEF3E2923B1D23F1DF196F33405BCFABF086476256B684D6FCE4B74CB961B8AB20678CA7B0866CED5AD4F47D5B93F3B2020B6F2B7B1B77210B17A258232D2DDA63799171CF80562CDCF0A27D0B5E2C40EC60B77128AB709C4A51F15CA9B70FFD88D1CFB2F9EAC296BF53950BD10FF4745E1FC6960DC157604CA2F96E98DA23A23636660176123C2FD6937445EC3FE91203FFA90798AA34667DBE5ADFC1E44BB2A6FC7C820B8E0221789C2038A30C4DD7C8B317CDF2724FAFA202023777EC3020301987B300D06092A864886F70D01010B05000382010100787CD0DF2B1CD476F66320B8A6D89796FA127865B34556C7F177A037BE81F677A7E0125C73EA646F3E7B40700D9874432919DE0F1EB5204BE32384522E4F1218A5102BA7CBEF8DA8522D1E17B2517145262879A82A8FF30FAA8AC7958A09C89511FFA2E98D5CCB741D951E5AF8741B8DCD73FE8E756DA0D8EB6350A8D0DD6B5B34FF599F1FA892BB940333AB5A960DD15E4FA84E455EBAECB25CA461BEA8BB7C5386F9A4A301DD772977C7F92851DD677EB6B9614018F61CDF15F502F1275183CD39392CBE13023E744D34EA3F75751D44C8D29986A120D50E566F60461915DB0180CE19EB97E8D13D5FE57680AA83FA46AEC5FCFEB767FA973584B9E69EC68F870202C4010423B6135C800202BA308202B63082019E020101300D06092A864886F70D01010B05003021310B300906035504031302483531123010060355040A1309477561726474696D65301E170D3134313230383039303334375A170D3137303130383039303334375A3021310B300906035504031302483531123010060355040A1309477561726474696D6530820122300D06092A864886F70D01010105000382010F003082010A0282010100BAD30A213436EB9B200BFFB5AEA46611160F2C062CEBC89BA9D470D5FD826F855028EE3B7ADE7AF3BB1AA70037AA97379E9361AE62E821E4B6D8451F04781B71137B2C21A6E57394CB28F663D61CC9F93B30DFD06B6D879B414C2EB3153E05472543D4E9C6048033A7976B9C36A62F68F1E88754CC735D0E5CE411345C64921F82114687A3FF19DE6A55E0C4D205BC49B5E2C16F900834E16410C03F594E658C63CD161DE60316BFAFECDE76D2BD7D18CC9373C62847C0DF588D252C162B706D720D7BBA81995A2C3F97ADBEB7DD09FB5918160F47A30A1F6D6966C40C1C2873A68CF326432DF06C1316104A7F113027155D98C366FE64EFE2106A8CE08F4ABB0203016AB9300D06092A864886F70D01010B05000382010100B9F3CAD1AFC720C47FC7C3684AF1215699A54719AD64A27E205CDE32B78773EF153B9A63DF034FD91E6365F5BCCF6649E301BAC45D31B224151380EBEB9450D117969EE5404A19F7F3751F8BC21AC72F65604EB9AEBAF2AC363EB5024280F9A4FD520C7FF42692B8C17F9793C6DD8BE43A707BB6A7AD3AAF83C1B4956FDA8479CBE2DA8214C2D74A53FB8F8443CAC33E6B1E89AB6F49AF5D25DCF744CFDB211F8A8BD38EE67058A4F05026EBC34C9D6B7D649FAFB243D1E8C3395786F4E7CDD23DBA2FFB02855E6E67144CB3F9AF2254626C7A97534FA878E1820AC6466FA60DDBB9CB161E5351DAAD1916C9BAEDDFFFCB5834B6BB19BFE223A69FA4EF274577870300BD1029020453ED4D80042101F41157B228426C657EF81740CABAE530572C313DC4DA916306E67BD9B77428650927C384726970C3A465762C204953534E3A20313430362D323538352C2031392E30382E3230313400092D46696E616E6369616C2054696D65732C204953534E3A20303330372D313736362C20323031342D30382D313900093868747470733A2F2F747769747465722E636F6D2F477561726454696D652F7374617475732F35303138303131363135353336323039393200870300BD1029020454162C00042101C1679EDC2E2A23D1BA9B4F49845C7607AEEF48AD1A344A1572A70907A86FF0400927C384726970C3A465762C204953534E3A20313430362D323538352C2031382E30392E3230313400092D46696E616E6369616C2054696D65732C204953534E3A20303330372D313736362C20323031342D30392D313800093868747470733A2F2F747769747465722E636F6D2F477561726474696D652F7374617475732F35313235393932313839363034383233303400870300BD10290204543DB900042101971985BB0BA261CE586612FEAFAA85C38DA139C97E19EB76C3050DF10D31F96E0927C384726970C3A465762C204953534E3A20313430362D323538352C2031372E31302E3230313400092D46696E616E6369616C2054696D65732C204953534E3A20303330372D313736362C20323031342D31302D313700093868747470733A2F2F747769747465722E636F6D2F477561726474696D652F7374617475732F35323331323337383731363932363737313200870300BD1029020454669780042101A559CE887CB699A6E02EA3A982E0377283BA573BEB160D0378AD6382681A53010927C384726970C3A465762C204953534E3A20313430362D323538352C2031382E31312E3230313400092D46696E616E6369616C2054696D65732C204953534E3A20303330372D313736362C20323031342D31312D313800093868747470733A2F2F747769747465722E636F6D2F477561726474696D652F7374617475732F35333438303631393830353536323838303100870300BD10290204548E248004210112E7C0C9D1BE975E75EF183EB7242DCDECF7ED2027A5F4BA819812FA2B3D6E400927C384726970C3A465762C204953534E3A20313430362D323538352C2031382E31322E3230313400092D46696E616E6369616C2054696D65732C204953534E3A20303330372D313736362C20323031342D31322D313800093868747470733A2F2F747769747465722E636F6D2F477561726474696D652F7374617475732F35343539353738313139343833363337373600870300BD1029020454B703000421019E363329E04954EE5D30090F635B12F399F64B4E10BC68DF215F9DE8DBF9E3AF0927C384726970C3A465762C204953534E3A20313430362D323538352C2032302E30312E3230313500092D46696E616E6369616C2054696D65732C204953534E3A20303330372D313736362C20323031352D30312D323000093868747470733A2F2F747769747465722E636F6D2F477561726474696D652F7374617475732F35353735323135333430373236363831363100870300BD1029020454DFE180042101735BDD50899F2ED4D7317E5B6C52096B78DB6B176A746F3E0DB406632B04584B0927C384726970C3A465762C204953534E3A20313430362D323538352C2031382E30322E3230313500092D46696E616E6369616C2054696D65732C204953534E3A20303330372D313736362C20323031352D30322D313800093868747470733A2F2F747769747465722E636F6D2F477561726474696D652F7374617475732F35363830373634323031303834343336343900870300BD102902045504CB800421010244A2BD7CFA72DC64868933764B0B369673F094D3E4085B30AB89A7EFC89D750927C384726970C3A465762C204953534E3A20313430362D323538352C2031382E30332E3230313500092D46696E616E6369616C2054696D65732C204953534E3A20303330372D313736362C20323031352D30332D313800093868747470733A2F2F747769747465722E636F6D2F477561726474696D652F7374617475732F35373831363739383336323237333338323400870300BD10290204552DAA00042101F5D4A4DDA576C114FB6C14941FE797DD5755536720FD3137575FADFBCAD530290927C384726970C3A465762C204953534E3A20313430362D323538352C2031372E30342E3230313500092D46696E616E6369616C2054696D65732C204953534E3A20303330372D313736362C20323031352D30342D313700093868747470733A2F2F747769747465722E636F6D2F477561726474696D652F7374617475732F35383930333437303236373935303238343800870300BD102902045555370004210186D8B2BB58B7B6186D5E596A2BD09D169125D80D4F94A5E4795A7C9F25063DC60927C384726970C3A465762C204953534E3A20313430362D323538352C2031392E30352E3230313500092D46696E616E6369616C2054696D65732C204953534E3A20303330372D313736362C20323031352D30352D313900093868747470733A2F2F747769747465722E636F6D2F477561726474696D652F7374617475732F36303036323631303535303732393131333600870300BD10290204557E1580042101B51561F424ACCA7B80A82DBC54645905247B7BAFFBE36F75C87E145D385180380927C384726970C3A465762C204953534E3A20313430362D323538352C2031372E30362E3230313500092D46696E616E6369616C2054696D65732C204953534E3A20303330372D313736362C20323031352D30362D313700093868747470733A2F2F747769747465722E636F6D2F477561726474696D652F7374617475732F36313131303339383038373030373032373200870300BD1029020455A5A280042101A6AAA55F992BDF96DF74154E331F5E3992CE8644FBF1A9FB470D8E3E2BEAE4160927C384726970C3A465762C204953534E3A20313430362D323538352C2031372E30372E3230313500092D46696E616E6369616C2054696D65732C204953534E3A20303330372D313736362C20323031352D30372D313700093868747470733A2F2F747769747465722E636F6D2F477561726474696D652F7374617475732F36323230313838383432353839333437383400870300BD1029020455CE810004210115BA5EB48C064B198A09D37E8C022C281C1CA1E36216EA43E811DF51A72680130927C384726970C3A465762C204953534E3A20313430362D323538352C2031392E30382E3230313500092D46696E616E6369616C2054696D65732C204953534E3A20303330372D313736362C20323031352D30382D313900093868747470733A2F2F747769747465722E636F6D2F477561726474696D652F7374617475732F36333431323637353438323337303034383000870300BD1029020455F75F800421011529A8960EF8B982A63868960C0C3DF0C6204B4E1DC736D35C3AD5BE741B306B0927C384726970C3A465762C204953534E3A20313430362D323538352C2031372E30392E3230313500092D46696E616E6369616C2054696D65732C204953534E3A20303330372D313736362C20323031352D30392D313700093868747470733A2F2F747769747465722E636F6D2F477561726474696D652F7374617475732F36343435373137343835353434303739333600870300BD10290204561EEC80042101BD697B39B297CE74E9BE2474350B45AF87D13F83082B17E219008ED735DD9BFC0927C384726970C3A465762C204953534E3A20313430362D323538352C2031372E31302E3230313500092D46696E616E6369616C2054696D65732C204953534E3A20303330372D313736362C20323031352D31302D313700093868747470733A2F2F747769747465722E636F6D2F477561726474696D652F7374617475732F36353633393139383838363239333039343400870300BD102902045647CB00042101F418953D0F61FC708C885E4B2F427C3CF1113FA5FF940953667D9087F5E585C30927C384726970C3A465762C204953534E3A20313430362D323538352C2031382E31312E3230313500092D46696E616E6369616C2054696D65732C204953534E3A20303330372D313736362C20323031352D31312D313800093868747470733A2F2F747769747465722E636F6D2F477561726474696D652F7374617475732F36363730363737353532313330333735363800870300BD10290204566F58000421015B03ED2112608A94FED5C844D53BB861A2630A98081AFEF3D2BE66A9818A661A0927C384726970C3A465762C204953534E3A20313430362D323538352C2031372E31322E3230313500092D46696E616E6369616C2054696D65732C204953534E3A20303330372D313736362C20323031352D31322D313700093868747470733A2F2F747769747465722E636F6D2F477561726474696D652F7374617475732F36373739313435343035383832373336363400870300BD102902045698368004210176197BDA8FB0E9C94193A12CAF33D6998B9EE39AFF6D3A868C112E0F1E24D7F2092D46696E616E6369616C2054696D65732C204953534E3A20303330372D313736362C20323031362D30312D3139000927C384726970C3A465762C204953534E3A20313430362D323538352C2031392E30312E3230313600093868747470733A2F2F747769747465722E636F6D2F477561726474696D652F7374617475732F36383934333934363433353630383537363000870300BD1029020456C115000421011878289E1A333DD85091D30F001B9F6F9ED4D428D57E049BD0EBD4DBC89BD210092D46696E616E6369616C2054696D65732C204953534E3A20303330372D313736362C20323031362D30322D3137000927C384726970C3A465762C204953534E3A20313430362D323538352C2031372E30322E3230313600093868747470733A2F2F747769747465722E636F6D2F477561726474696D652F7374617475732F36393939313935373130383435353833333600");

            byte[] sigBytes =
                Base16.Decode(
                    "308006092A864886F70D010702A0803080020101310F300D06096086480165030402010500308006092A864886F70D0107010000A08030820611308204F9A003020102021007545A312C625EC2F6254F8379516AD3300D06092A864886F70D01010B05003081A6310B3009060355040613025553311D301B060355040A131453796D616E74656320436F72706F726174696F6E311F301D060355040B131653796D616E746563205472757374204E6574776F726B311E301C060355040B1315506572736F6E61204E6F742056616C696461746564313730350603550403132E53796D616E74656320436C617373203120496E646976696475616C2053756273637269626572204341202D204735301E170D3136303230343030303030305A170D3137303230343233353935395A3081AD312E302C06035504030C25506572736F6E61204E6F742056616C696461746564202D20313435343630323936343731383129302706092A864886F70D010901161A7075626C69636174696F6E7340677561726474696D652E636F6D310F300D060355040B0C06532F4D494D45311E301C060355040B0C15506572736F6E61204E6F742056616C696461746564311F301D060355040B0C1653796D616E746563205472757374204E6574776F726B30820122300D06092A864886F70D01010105000382010F003082010A0282010100E477114FB652402673FFE2CA769FE3F8722AA6ED1A18FD79E73A310E660619980FB8DE812112D186E2D8800A867B493BE7C409925685B0C2BA4FCC0C90896934E307849B352903E7B69B848D834FC54C32646F7754C89FF8800F66013A1CABDE14C0B949F674E568D053209534D9B6D7FC205037EBD3A0B70ECA97D5FCD46EE0FC14444001AAB2F89FBEFE8BFA7509C9A02339864618574A6D2A93AA088FBF67ECA37336912FBF048AAD01F74B741882CB25D65E47F01519B6BB7272340F7604D2CD905B366905379C92CF5E25CA5B5E9EF906DA9F94EB1D91F5FD88FB140017452E6448ACF108FF4D600AF9491E60099842ADEB47765523D454F64AD9152215020300A239A38202303082022C300C0603551D130101FF04023000300E0603551D0F0101FF0404030205A030200603551D250101FF0416301406082B0601050507030406082B06010505070302301D0603551D0E04160414BBF3E234661D61D804E4571C9CE2E701E784DE6030250603551D11041E301C811A7075626C69636174696F6E7340677561726474696D652E636F6D306C0603551D20046530633061060B6086480186F845010717013052302606082B06010505070201161A687474703A2F2F7777772E73796D617574682E636F6D2F637073302806082B06010505070202301C1A1A687474703A2F2F7777772E73796D617574682E636F6D2F727061305D0603551D1F045630543052A050A04E864C687474703A2F2F706B692D63726C2E73796D617574682E636F6D2F63615F35376465376132333864343564386434666337316638613563366238316339332F4C617465737443524C2E63726C304E06082B0601050507010104423040303E06082B060105050730028632687474703A2F2F63616365722E73796D617574682E636F6D2F6D706B692F73796D636331696E64737562636167352E637274301F0603551D230418301680146719B63DA579BB3360D82D53D38C093D07AC1870302B060A6086480186F845011003041D301B06126086480186F84501100102020401ADEE9213160531303932323039060A6086480186F845011005042B302902010016246148523063484D364C79397761326B74636D457563336C74595856306143356A6232303D300D06092A864886F70D01010B0500038201010094462051099CDE3966A822E91040C9C1475718CD7C145F14DD80FC67749EE9D3BAC9C013F7295F80D8AFBDA771107B92711B40F8CAEF6B82649B67598D3E010AE06744C2EEEA478B3D88971B6047CCAF4559CF578D1AEF0A09503CFA64111C31B8F816772298ADED50868D446C5CEDC01385707DDEE369BED1854186A7E286824147B5AD9F131AD5FA79C4ECBC7C69BC6A289F9A93B4F1FCAE5BA02254610F436196259498B8F2B3F76D58CA249DDA913587482CACC18B3FB5F41C4951B9B29A008D4DDC283C92C0D8B794EF9D6B09236CBB8E2D08B02BB26B80B5370B0B27DBD72B48F0CDE0E1DDF6815C7F0146A4E53260B583512FD9176C3B76D868E5A5833082063C30820524A00302010202100702A21A85B84B659E180A6EE6F5A365300D06092A864886F70D01010B05003081CA310B300906035504061302555331173015060355040A130E566572695369676E2C20496E632E311F301D060355040B1316566572695369676E205472757374204E6574776F726B313A3038060355040B1331286329203139393920566572695369676E2C20496E632E202D20466F7220617574686F72697A656420757365206F6E6C79314530430603550403133C566572695369676E20436C6173732031205075626C6963205072696D6172792043657274696669636174696F6E20417574686F72697479202D204733301E170D3135313030313030303030305A170D3235303933303233353935395A3081A6310B3009060355040613025553311D301B060355040A131453796D616E74656320436F72706F726174696F6E311F301D060355040B131653796D616E746563205472757374204E6574776F726B311E301C060355040B1315506572736F6E61204E6F742056616C696461746564313730350603550403132E53796D616E74656320436C617373203120496E646976696475616C2053756273637269626572204341202D20473530820122300D06092A864886F70D01010105000382010F003082010A0282010100D6FB0D314922C00CBAEF4E2D17B8B430E534D2AC09EEC989005DF4AE1311B3138E55CF2218A82006A6FD25CB6894B4A082900E6E969244EE15B9B4ECFACF793D69D49C1FDC209A0E28D50DB5C69E3AF1D46519C084334D8EDA8AF1D627B903A0D1FA289C82936CF70D857D5BE94E9962FE9342D2EE3EB37157869746CBDF0DE1C6845AB30D8FF5F4108A055D9F6846EC08B0584282F6BE2D1046A6240B27FE981453839382DBEAC03F4FA25861B54B7269125F3359F6F9B34C0064CE85C586920C6E1CEB28CF71A990A974997424EB48E10E5D6812A80166E8EE9AB22FF83DCDB77824CEA5607CE8163D49F107BA33BE322BC267A316C76FC0D25A9404C26B450203010001A382023E3082023A303706082B06010505070101042B3029302706082B06010505073001861B687474703A2F2F706B692D6F6373702E73796D617574682E636F6D30120603551D130101FF040830060101FF020100306C0603551D20046530633061060B6086480186F845010717013052302606082B06010505070201161A687474703A2F2F7777772E73796D617574682E636F6D2F637073302806082B06010505070202301C1A1A687474703A2F2F7777772E73796D617574682E636F6D2F727061302F0603551D1F042830263024A022A020861E687474703A2F2F732E73796D63622E636F6D2F706361312D67332E63726C300E0603551D0F0101FF04040302010630290603551D1104223020A41E301C311A30180603550403131153796D616E746563504B492D322D323137301D0603551D0E041604146719B63DA579BB3360D82D53D38C093D07AC18703081F10603551D230481E93081E6A181D0A481CD3081CA310B300906035504061302555331173015060355040A130E566572695369676E2C20496E632E311F301D060355040B1316566572695369676E205472757374204E6574776F726B313A3038060355040B1331286329203139393920566572695369676E2C20496E632E202D20466F7220617574686F72697A656420757365206F6E6C79314530430603550403133C566572695369676E20436C6173732031205075626C6963205072696D6172792043657274696669636174696F6E20417574686F72697479202D2047338211008B5B75568454850B00CFAF3848CEB1A4300D06092A864886F70D01010B050003820101004619E427753BBEAFE2DAA214608F1E449081692B6349358DE976BA9F988F1381D7CBFC651BF80E63DE942874FBE36FD8C92A7A0E54A683AE294AF62B51FD3D3812BBDD6345FB64CC3E54867F4E426D23B71D0BFDFACC0D8E9335CAE545F9CF2F7F793D6318C747234AF6A91400AD7E59551A8927DB94A09138C6FE4095A360F65DB8C8C516ED9C66691446104ACA702A6FD150E0261AD352B447728B45D2BD03B9A5DCD908F390AB7470ABCAA04EF0C04EE4E0BE4F901160270C2B1CDFE76CCA75B425E79148AA92B451755F299B47171CBDC9EACF75AD7523CFF2C5DF5AABB76BCABBB85EABD5A370D468F3177A9B0BA0143CFBE8815668E8CF5D7C73B82EBC0000318202523082024E0201013081BB3081A6310B3009060355040613025553311D301B060355040A131453796D616E74656320436F72706F726174696F6E311F301D060355040B131653796D616E746563205472757374204E6574776F726B311E301C060355040B1315506572736F6E61204E6F742056616C696461746564313730350603550403132E53796D616E74656320436C617373203120496E646976696475616C2053756273637269626572204341202D204735021007545A312C625EC2F6254F8379516AD3300D06096086480165030402010500A069301806092A864886F70D010903310B06092A864886F70D010701301C06092A864886F70D010905310F170D3136303231373135313831305A302F06092A864886F70D01090431220420CC6285AD281DD2D874A0FB51D79AD4B5CC34CC9A37E212152B01EC7B06EFFD92300D06092A864886F70D010101050004820100657A35B46B1EC1EE77C96E575D162BBA05C063BD03D95707EA0F796089AD1C1354B973DB5F7BA749886B6D5E82D0B350E847D917C276F06A4C79AC50586F0A47EA59786C51011D149C6AE94B4C61535FDE1C6898899087ACE23C7784DD82503E73708AFFC5B2FEA7580965C4753500C3DABB77AC343303F7DF1FBF4767CC7DFE9874C2447A694F2819642D9573D545E7F3893231B7F77D82768E5B79270E94919D9CE1E798F0DF23B7C81B4F0F58B28CB159A3C49B1CB7E842B93AB9B54CA78D3B93C22CB1B8A55648D3AC6DAFC9A117E97614ABC4C5ACAAC72AC81B3D35C16D26A3E4AC1448B95F4217D9504A815A97FEBE55230F9EF104B66AD9A029093B65000000000000");

            PkiTrustStoreProvider trustStoreProvider = new PkiTrustStoreProvider(new X509Store(StoreName.Root),
                CryptoTestFactory.CreateCertificateSubjectRdnSelector("E=publications@guardtime.com"));

            trustStoreProvider.Verify(data, sigBytes);

            Assert.Throws<PkiVerificationErrorException>(delegate
            {
                trustStoreProvider.Verify(null, sigBytes);
            });

            Assert.Throws<PkiVerificationErrorException>(delegate
            {
                trustStoreProvider.Verify(data, null);
            });
        }
    }
}